summary(allBrksLDf)
#--
folder1 <- "EVI_250m"
allBrksLDf <- readRDS(paste0("C:/Users/Peter R/Documents/st_trends_for_c/algonquin/output_h5p/", folder1,"/drac/allBrksbF0Df.rds")) # check
#allBrksLDf <- do.call(rbind.data.frame, allBrksL)
# This obj has all the pixels in the study area
names(allBrksLDf) <- c("pix","brk", "obs", "iter","brkdate25", "brkdate","brkdate95", "brkb1",  "brkb2", "magnitude")
dim(allBrksLDf) #
allBrksLDf <- (allBrksLDf[which(!is.na(allBrksLDf$brk)),]) # The df with all metrics is too big. Here I subset to ony extrcat forest pixels.
summary(allBrksLDf)
dim(allBrksLDf)
df2 <- sqldf("SELECT t1.pix, t1.brk, t1.brkdate25, t1.brkdate, t1.brkdate95, t1.magnitude, t2.year as fire_year, t3.year AS harv_year, t4.year AS insc_year, t5.value AS for_age,
t6.value AS for_type, t7.value AS for_pro , t8.value AS elev, t9.value AS map, t9.year as map_year
FROM allBrksLDf t1
LEFT JOIN df1Fire t2 ON t1.pix=t2.pix
LEFT JOIN df1Har t3 ON t1.pix=t3.pix
LEFT JOIN df1Insc t4 ON t1.pix=t4.pix
LEFT JOIN df1ForAge t5 ON t1.pix=t5.pix
LEFT JOIN df1ForType t6 ON t1.pix=t6.pix
LEFT JOIN df1ForPro t7 ON t1.pix=t7.pix
LEFT JOIN df1Elev t8 ON t1.pix=t8.pix
LEFT JOIN df1MAP t9 ON t1.pix=t9.pix
WHERE brk >= 0")
gc()
rm(cec)
rm(df1ForAge)
rm(df1ForPro)
df1ForPro <- readRDS(paste0(outf5,"df1ForPro.rds"))
df1ForAge <- readRDS(paste0(outf5,"df1ForAge.rds"))
df2 <- sqldf("SELECT t1.pix, t1.brk, t1.brkdate25, t1.brkdate, t1.brkdate95, t1.magnitude, t2.year as fire_year, t3.year AS harv_year, t4.year AS insc_year, t5.value AS for_age,
t6.value AS for_type, t7.value AS for_pro , t8.value AS elev, t9.value AS map, t9.year as map_year
FROM allBrksLDf t1
LEFT JOIN df1Fire t2 ON t1.pix=t2.pix
LEFT JOIN df1Har t3 ON t1.pix=t3.pix
LEFT JOIN df1Insc t4 ON t1.pix=t4.pix
LEFT JOIN df1ForAge t5 ON t1.pix=t5.pix
LEFT JOIN df1ForType t6 ON t1.pix=t6.pix
LEFT JOIN df1ForPro t7 ON t1.pix=t7.pix
LEFT JOIN df1Elev t8 ON t1.pix=t8.pix
LEFT JOIN df1MAP t9 ON t1.pix=t9.pix
WHERE brk >= 0")
rm(df2)
rm(dfClim)
rm(dfClim1)
rm(dfClim2)
rm(elevDf1)
rm(elevDf2)
rm(priOrd)
rm(largeMam)
df2 <- sqldf("SELECT t1.pix, t1.brk, t1.brkdate25, t1.brkdate, t1.brkdate95, t1.magnitude, t2.year as fire_year, t3.year AS harv_year, t4.year AS insc_year, t5.value AS for_age,
t6.value AS for_type, t7.value AS for_pro , t8.value AS elev, t9.value AS map, t9.year as map_year
FROM allBrksLDf t1
LEFT JOIN df1Fire t2 ON t1.pix=t2.pix
LEFT JOIN df1Har t3 ON t1.pix=t3.pix
LEFT JOIN df1Insc t4 ON t1.pix=t4.pix
LEFT JOIN df1ForAge t5 ON t1.pix=t5.pix
LEFT JOIN df1ForType t6 ON t1.pix=t6.pix
LEFT JOIN df1ForPro t7 ON t1.pix=t7.pix
LEFT JOIN df1Elev t8 ON t1.pix=t8.pix
LEFT JOIN df1MAP t9 ON t1.pix=t9.pix
WHERE brk >= 0")
dim(df2)
dim(allBrksLDf)
saveRDS(df2, paste0(outf5,"df2_analytic_df_v1.rds"))
df2S1 <- sqldf("SELECT * FROM df2 t1 WHERE t1.magnitude <0 AND round(df2.brkdate,0)=df2.map_year")
df2S1 <- sqldf("SELECT * FROM df2 t1 WHERE t1.magnitude <0 AND round(t1.brkdate,0)=t1.map_year")
dim(df2S1)
head(df2S1)
df2S1 <- sqldf("SELECT * FROM df2 t1 WHERE t1.magnitude <0 AND floor(t1.brkdate,0)=t1.map_year")
dim(df2S1)
head(df2S1)
rm(df2)
head(df3)
dim(df2S1)
df3Grp <- sqldf("SELECT year, patches, 1 as neg_brk, count (distinct pix) AS num_cells, count(brk) AS num_brks, sum(magnitude) AS magnitude, sum(fire) AS fire, sum(harv) AS harv, sum(insc) AS insc,
mode(for_age) AS for_age, mode(for_type) AS for_type, mode(for_pro) AS for_pro ,average(elev) AS elev, average(map) as map
FROM (
SELECT pix, brk, round(brkdate) as year, fire_year, harv_year, insc_year, patches, magnitude,
CASE WHEN fire_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END harv,
CASE WHEN insc_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM df3) t3
WHERE brk=0 AND magnitude <0 GROUP BY year, patches")
df3 <- sqldf("SELECT t1.* , t2.patches FROM df2S1 t1 LEFT JOIN r10Pdf t2 ON t1.pix=t2.cell")
dim(df3)
str(df3)
head(df3[sample(which(df3$brk==0), 10),])
df3Grp <- sqldf("SELECT year, patches, 1 as neg_brk, count (distinct pix) AS num_cells, count(brk) AS num_brks, sum(magnitude) AS magnitude, sum(fire) AS fire, sum(harv) AS harv, sum(insc) AS insc,
mode(for_age) AS for_age, mode(for_type) AS for_type, mode(for_pro) AS for_pro ,average(elev) AS elev, average(map) as map
FROM (
SELECT pix, brk, round(brkdate) as year, fire_year, harv_year, insc_year, patches, magnitude,
CASE WHEN fire_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END harv,
CASE WHEN insc_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM df3) t3
WHERE brk=0 AND magnitude <0 GROUP BY year, patches")
df3Grp <- sqldf("SELECT year, patches, 1 as neg_brk, count (distinct pix) AS num_cells, count(brk) AS num_brks, sum(magnitude) AS magnitude, sum(fire) AS fire, sum(harv) AS harv, sum(insc) AS insc,
mode(for_age) AS for_age, mode(for_type) AS for_type, mode(for_pro) AS for_pro, mean(elev) AS elev, mean(map) as map
FROM (
SELECT pix, brk, round(brkdate) as year, fire_year, harv_year, insc_year, patches, magnitude,
CASE WHEN fire_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END harv,
CASE WHEN insc_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM df3) t3
WHERE brk=0 AND magnitude <0 GROUP BY year, patches")
df3Grp <- sqldf("SELECT year, patches, 1 as neg_brk, count (distinct pix) AS num_cells, count(brk) AS num_brks, sum(magnitude) AS magnitude, sum(fire) AS fire, sum(harv) AS harv, sum(insc) AS insc,
mode(for_age) AS for_age, mode(for_type) AS for_type, mode(for_pro) AS for_pro, avg(elev) AS elev, avg(map) as map
FROM (
SELECT pix, brk, round(brkdate) as year, fire_year, harv_year, insc_year, patches, magnitude,
CASE WHEN fire_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END harv,
CASE WHEN insc_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM df3) t3
WHERE brk=0 AND magnitude <0 GROUP BY year, patches")
dim(df3Grp) # 5464    9
str(df3Grp)
summary(df3Grp)
head(df3Grp)
head(df3Grp[which(df3Grp$num_brks>10),], 50)
dfTest <- df3Grp[!is.na(df3Grp$for_age),]
summary(dfTest)
dfTest <- df3Grp[!is.na(df3Grp$for_age) & !is.na(df3Grp$for_type),]
summary(dfTest)
dfTest <- df3Grp[!is.na(df3Grp$for_age) & !is.na(df3Grp$for_type) & !is.na(df3Grp$for_pro),]
summary(dfTest)
dim(dfTest)
nrow(dfTest)
dim(dfTest[sample(nrow(dfTest)*0.10, ),])
dfTest1 <- dfTest[sample(nrow(dfTest)*0.10, ),]
write.csv(dfTest1, paste0(outf5, dfTest1.csv, row.names=F)
)
write.csv(dfTest1, paste0(outf5, "dfTest1.csv"), row.names=F)
outf5
summary(dfTest1)
summary(dfTest)
require(xgboost)
#============================
# XGBoost Test Drive
#============================
install.packages("xgboost")
require(xgboost)
require(Matrix)
require(data.table)
summary(dfTest1)
str(dfTest1)
df
df10 <- data.table(dfTest1, keep.rownames = FALSE)
head(df10)
head(df2S1)
df2S1 <- sqldf("SELECT * FROM df2 t1 WHERE floor(t1.brkdate)=t1.map_year")
df2 <- readRDS(paste0(outf5,"df2_analytic_df_v1.rds"))
df3 <- sqldf("SELECT t1.* , t2.patches FROM df2S1 t1 LEFT JOIN r10Pdf t2 ON t1.pix=t2.cell")
dim(df3)
df2S1 <- sqldf("SELECT * FROM df2 t1 WHERE floor(t1.brkdate)=t1.map_year")
dim(df2S1)
head(df2S1)
rm(df2)
dim(df3)
df3 <- sqldf("SELECT t1.* , t2.patches FROM df2S1 t1 LEFT JOIN r10Pdf t2 ON t1.pix=t2.cell")
dim(df3)
str(df3)
df3Grp <- sqldf("SELECT year, patches, 1 as neg_brk, count (distinct pix) AS num_cells, count(brk) AS num_brks, sum(magnitude) AS magnitude, sum(fire) AS fire, sum(harv) AS harv, sum(insc) AS insc,
mode(for_age) AS for_age, mode(for_type) AS for_type, mode(for_pro) AS for_pro, avg(elev) AS elev, avg(map) as map
FROM (
SELECT pix, brk, round(brkdate) as year, fire_year, harv_year, insc_year, patches, magnitude,
CASE WHEN fire_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END harv,
CASE WHEN insc_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM df3) t3
GROUP BY year, patches")
dfTest <- df3Grp[!is.na(df3Grp$for_age) & !is.na(df3Grp$for_type) & !is.na(df3Grp$for_pro),]
summary(dfTest)
dim(dfTest)
dim(df3Grp) # 5464    9
str(df3Grp)
summary(df3Grp)
head(df3Grp)
head(df3Grp[which(df3Grp$num_brks>10),], 50)
dfTest <- df3Grp[!is.na(df3Grp$for_age) & !is.na(df3Grp$for_type) & !is.na(df3Grp$for_pro),]
dim(dfTest)
dim(dfTest)
dfTest1 <- dfTest[sample(nrow(dfTest)*0.10, ),]
head(dfTest1)
summary(dfTest1)
df3Grp <- sqldf("SELECT year, patches, brk, count (distinct pix) AS num_cells, count(brk) AS num_brks, sum(magnitude) AS magnitude, sum(fire) AS fire, sum(harv) AS harv, sum(insc) AS insc,
mode(for_age) AS for_age, mode(for_type) AS for_type, mode(for_pro) AS for_pro, avg(elev) AS elev, avg(map) as map
FROM (
SELECT pix, brk, round(brkdate) as year, fire_year, harv_year, insc_year, patches, magnitude,
CASE WHEN fire_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END harv,
CASE WHEN insc_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM df3) t3
GROUP BY year, patches")
dim(df3Grp) # 5464    9
str(df3Grp)
summary(df3Grp)
dfTest <- df3Grp[!is.na(df3Grp$for_age) & !is.na(df3Grp$for_type) & !is.na(df3Grp$for_pro),]
summary(dfTest)
dim(dfTest)
dfTest1 <- dfTest[sample(nrow(dfTest)*0.10, ),]
summary(dfTest1)
summary(dfTest)
df3Grp <- sqldf("SELECT year, patches, brk, count (distinct pix) AS num_cells, count(brk) AS num_brks, sum(magnitude) AS magnitude, sum(fire) AS fire, sum(harv) AS harv, sum(insc) AS insc,
mode(for_age) AS for_age, mode(for_type) AS for_type, mode(for_pro) AS for_pro, avg(elev) AS elev, avg(map) as map
FROM (
SELECT pix, brk, round(brkdate) as year, fire_year, harv_year, insc_year, patches, magnitude,
CASE WHEN fire_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END harv,
CASE WHEN insc_year between brkdate25 AND brkdate95 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM df3) t3
GROUP BY year, patches")
summary(df3Grp)
r10
head(r10Pdf)
fpath12
fpath12 <- "C:/Users/Peter R/Documents/st_trends_for_c/algonquin/output_h5p/EVI_250m/drac/rasters/EVI_posBrks_16d.tif"
r11
r10
r10P <- patches(r10, directions=8, zeroAsNA=TRUE, allowGaps=TRUE)
r10P
r10Pdf <- as.data.frame(r10P, row.names=NULL, optional=FALSE, xy=FALSE, cells=TRUE, na.rm=NA)
head(r10Pdf)
r11 <- rast(fpath11) # EVI positive breaks
r11 <- rast(fpath12) # EVI positive breaks
r11
r11P <- patches(r11, directions=8, zeroAsNA=TRUE, allowGaps=TRUE)
plot(r11P)
r11Pdf <- as.data.frame(r11P, row.names=NULL, optional=FALSE, xy=FALSE, cells=TRUE, na.rm=NA)
head(r11Pdf)
tail(r11Pdf)
str(r11Pdf)
r11Pdf$patch_id <- paste0("p", r11Pdf$patches)
r10P <- patches(r10, directions=8, zeroAsNA=TRUE, allowGaps=TRUE)
r10Pdf <- as.data.frame(r10P, row.names=NULL, optional=FALSE, xy=FALSE, cells=TRUE, na.rm=NA)
head(r10Pdf)
r10Pdf$patch_id <- paste0("n", r10Pdf$patches)
tail(r10Pdf)
dim(df3)
head(df2)
dim(df2) # 281991     11; 282761     12; 282767     13; 282767     14; 282767     16282767     16; 6508889      18
head(df2S1)
summary(df2S1)
df2 <- readRDS(paste0(outf5,"df2_analytic_df_v1.rds"))
summary(df2)
dim(df2[which(df2$brk==0),])
dim(df2[which(df2$brk==1),])
dim(df2) # 281991     11; 282761     12; 282767     13; 282767     14; 282767     16282767     16; 6508889      18
dim(df3)
summary(df2S1)
head(df2S1)
head(df2)
head(df2[which(df2$map_year>=2018),])
head(df2[which(df2$map_year=2018),])
head(df2[which(df2$map_year==2018),])
head(df2[which(df2$map_year==2018),], 10)
head(df2[which(df2$map_year==2018 & df2$ins_year<=2018),], 10)
head(df2[which(df2$map_year==2018 & df2$insc_year<=2018),], 10)
dim(df2[which(df2$map_year==2018 & df2$insc_year<=2018),], 10)
dim(df2[which(df2$map_year==2018 & df2$insc_year<=2018),])
dim(df2[which(df2$map_year==2018 & df2$insc_year<=2018 & df2$fire_year<=2018 & df2$harvest_year<=2018),])
dim(df2[which(df2$map_year==2018 & df2$insc_year<=2018 & df2$fire_year<=2018 & df2$harv_year<=2018),])
dim(df2[which(df2$map_year==2017 & df2$insc_year<=2017 & df2$fire_year<=2017 & df2$harv_year<=2017),])
dim(df2[which(df2$map_year==2013 & df2$insc_year<=2013 & df2$fire_year<=2013 & df2$harv_year<=2013),])
dim(df2[which(df2$map_year==2020 & df2$insc_year<=2020 & df2$fire_year<=2020 & df2$harv_year<=2020),])
test1 <- (df2[which(df2$map_year==2020 & df2$insc_year<=2020 & df2$fire_year<=2020 & df2$harv_year<=2020),])
sumamry(test1)
summary(test1)
head(test1)
tail(test1)
head(test1[which(test1$brk==0),])
rm(df2)
summary(test1)
gc()
head(allBrksLDf[,1])
head(allBrksLDf)
nrow(allBrksLDf[,1])
dim(allBrksLDf[,1])
str(allBrksLDf[,1])
cbind(allBrksLDf[1:10,1], seq(1998:2021))
1998:2021
cbind(allBrksLDf[1:10,1], 1998:2021)
cbind(allBrksLDf[1:10,1], 1998)
cbind(allBrksLDf[1:10,1], repeat(1998:1999, 10))
rep(1998:1999, 10)
rep(1998,10)
cbind(allBrksLDf[1:10,1], rep(1998,10))
d <- data.frame(pix = allBrksLDf[1:10,1], year = c(1998))
d
period1 <- seq(1998:2001)
period1
period1 <- c(1998:2001)
period1
dfTempL <- foreach (i=1:length(years1)) %do% {
data.frame(pix = allBrksLDf[1:10,1], year = years1[i])
}
years1 <- c(1998:2001)
dfTempL <- foreach (i=1:length(years1)) %do% {
data.frame(pix = allBrksLDf[1:10,1], year = years1[i])
}
dfTemp <- do.call("rbind", dfTempL)
dfTemp
length(1998:2022)
summary(allBrksLDf)
dim(allBrksLDf)
head(allBrksLDf[,1])
281991x25
281991*25
years1 <- c(1998:2021)
dfTempL <- foreach (i=1:length(years1)) %do% {
data.frame(pix = allBrksLDf[,1], year = years1[i])
}
dfTemp <- do.call("rbind", dfTempL)
dim(dfTemp)
years1 <- c(1998:2022)
dfTempL <- foreach (i=1:length(years1)) %do% {
data.frame(pix = allBrksLDf[,1], year = years1[i])
}
dfTemp <- do.call("rbind", dfTempL)
dim(dfTemp)
dim(df2)
df2 <- sqldf("SELECT t0.pix, t0.year, t1.brk, t1.brkdate25, t1.brkdate, t1.brkdate95, t1.magnitude, t2.year as fire_year, t3.year AS harv_year, t4.year AS insc_year, t5.value AS for_age,
t6.value AS for_type, t7.value AS for_pro , t8.value AS elev, t9.value AS map, t9.year as map_year
FROM dfTemp t0
LEFT JOIN allBrksLDf t1 ON t0.pix=t1.pix AND t0.year=t1.year
LEFT JOIN df1Fire t2 ON t0.pix=t2.pix AND t0.year=t2.year
LEFT JOIN df1Har t3 ON t0.pix=t3.pix AND t0.year=t3.year
LEFT JOIN df1Insc t4 ON t0.pix=t4.pix AND t0.year=t4.year
LEFT JOIN df1ForAge t5 ON t0.pix=t5.pix AND t0.year=t5.year
LEFT JOIN df1ForType t6 ON t0.pix=t6.pix AND t0.year=t6.year
LEFT JOIN df1ForPro t7 ON t0.pix=t7.pix AND t0.year=t7.year
LEFT JOIN df1Elev t8 ON t0.pix=t8.pix AND t0.year=t8.year
LEFT JOIN df1MAP t9 ON t0.pix=t9.pix AND t0.year=t9.year
")
df2 <- sqldf("SELECT t0.pix, t0.year, t1.brk, t1.brkdate25, t1.brkdate, t1.brkdate95, t1.magnitude, t2.year as fire_year, t3.year AS harv_year, t4.year AS insc_year, t5.value AS for_age,
t6.value AS for_type, t7.value AS for_pro , t8.value AS elev, t9.value AS map, t9.year as map_year
FROM dfTemp t0
LEFT JOIN allBrksLDf t1 ON t0.pix=t1.pix AND t0.year=round(t1.brkdate)
LEFT JOIN df1Fire t2 ON t0.pix=t2.pix AND t0.year=t2.year
LEFT JOIN df1Har t3 ON t0.pix=t3.pix AND t0.year=t3.year
LEFT JOIN df1Insc t4 ON t0.pix=t4.pix AND t0.year=t4.year
LEFT JOIN df1ForAge t5 ON t0.pix=t5.pix AND t0.year=t5.year
LEFT JOIN df1ForType t6 ON t0.pix=t6.pix AND t0.year=t6.year
LEFT JOIN df1ForPro t7 ON t0.pix=t7.pix AND t0.year=t7.year
LEFT JOIN df1Elev t8 ON t0.pix=t8.pix AND t0.year=t8.year
LEFT JOIN df1MAP t9 ON t0.pix=t9.pix AND t0.year=t9.year
")
df2 <- sqldf("SELECT t0.pix, t0.year, t1.brk, t1.brkdate25, t1.brkdate, t1.brkdate95, t1.magnitude, t2.year as fire_year, t3.year AS harv_year, t4.year AS insc_year, t5.value AS for_age,
t6.value AS for_type, t7.value AS for_pro , t8.value AS elev, t9.value AS map, t9.year as map_year
FROM dfTemp t0
LEFT JOIN allBrksLDf t1 ON t0.pix=t1.pix AND t0.year=round(t1.brkdate)
LEFT JOIN df1Fire t2 ON t0.pix=t2.pix AND t0.year=t2.year
LEFT JOIN df1Har t3 ON t0.pix=t3.pix AND t0.year=t3.year
LEFT JOIN df1Insc t4 ON t0.pix=t4.pix AND t0.year=t4.year
LEFT JOIN df1ForAge t5 ON t0.pix=t5.pix
LEFT JOIN df1ForType t6 ON t0.pix=t6.pix
LEFT JOIN df1ForPro t7 ON t0.pix=t7.pix
LEFT JOIN df1Elev t8 ON t0.pix=t8.pix
LEFT JOIN df1MAP t9 ON t0.pix=t9.pix AND t0.year=t9.year
")
dim(df2) # 281991     11; 282761     12; 282767     13; 282767     14; 282767     16282767     16; 6508889      18
summary(df2)
str(df2)
head(df2)
tail(df2)
saveRDS(df2, paste0(outf5,"df2_analytic_df_v1.rds"))
dfTest <- df2[!is.na(df2$for_type),]
dim(dfTest)
summary(dfTest)
dfTest1 <- sqldf(
"SELECT pix, year, CASE WHEN brk=0 THEN 1 ELSE 0 END As brk1, magnitude,
CASE WHEN fire_year > 0 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year > 0  THEN 1 ELSE 0 END harv,
CASE WHEN insc_year >  0 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM dfTest"
)
rm(dfTempL)
rm(dfTemp)
gc()
dfTest1 <- sqldf(
"SELECT pix, year, CASE WHEN brk=0 THEN 1 ELSE 0 END As brk1, magnitude,
CASE WHEN fire_year > 0 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year > 0  THEN 1 ELSE 0 END harv,
CASE WHEN insc_year >  0 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM dfTest"
)
rm(rforAge)
rm(rforAge2)
rm(rPro)
rm(rPro2Pj)
rm(rPro2)
rm(rPro3)
rm(rInsc)
rm(rInscL)
rm(rInscL2)
rm(rforAgeAgg)
rm(rforType)
rm(rforType2)
rm(rforType3)
gc()
dfTest1 <- sqldf(
"SELECT pix, year, CASE WHEN brk=0 THEN 1 ELSE 0 END As brk1, magnitude,
CASE WHEN fire_year > 0 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year > 0  THEN 1 ELSE 0 END harv,
CASE WHEN insc_year >  0 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM dfTest"
)
rm(sqlList1)
rm(sqlPrimer)
rm(vpolyList1)
rm(brksDf)
rm(brksDf1)
rm(df2)
dfTest1 <- sqldf(
"SELECT pix, year, CASE WHEN brk=0 THEN 1 ELSE 0 END As brk1, magnitude,
CASE WHEN fire_year > 0 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year > 0  THEN 1 ELSE 0 END harv,
CASE WHEN insc_year >  0 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM dfTest"
)
dim(dfTest)
gc()
df2
rm(priority_table)
rm(priority_table_red)
rm(r1)
rm(r10)
rm(r10P)
rm(r10Pdf)
rm(r11)
rm(r11P)
rm(r11Pdf)
rm(r1Agg)
rm(r1AggPj)
rm(r1Res)
rm(r1Seg)
rm(r1Tem)
rm(raster1)
rm(rasterRes1)
rm(elevPts)
rm(rEl)
rm(rElev1)
rm(rElev2)
rm(rOnt)
rm(rTest1)
rm(shp1L)
rm(view_table)
rm(df10)
rm(df1)
rm(cpcadPj)
rm(forType1)
gc()
View(df1MAP)
dfTest1 <- sqldf(
"SELECT pix, year, CASE WHEN brk=0 THEN 1 ELSE 0 END AS brk1, magnitude,
CASE WHEN fire_year > 0 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year > 0  THEN 1 ELSE 0 END harv,
CASE WHEN insc_year >  0 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM dfTest"
)
rm(allBrksLDf)
rm(df1Elev)
rm(df1Fire)
rm(df1ForAge)
rm(df1ForPro)
rm(df1ForType)
rm(df1Har)
rm(df1Insc)
rm(df1MAP)
gc()
rm(rClim)
rm(rClim2)
rm(rClimL)
rm(rClimPj)
rm(rClimPjAll)
rm(insc1)
gc()
saveRDS(df2, paste0(outf5,"df2_analytic_df_v1.rds"))
outf5
saveRDS(dfTest, paste0(outf5,"df3_analytic_df_v1.rds"))
dim(dfTest)
head(dfTest)
gc()
dfTest1 <- sqldf(
"SELECT pix, year, CASE WHEN brk=0 THEN 1 ELSE 0 END AS brk1, magnitude,
CASE WHEN fire_year > 0 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year > 0  THEN 1 ELSE 0 END harv,
CASE WHEN insc_year >  0 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM dfTest"
)
dfTest$brk1 <- ifelse(dfTest$brk==0, 1, 0)
dfTest1 <- sqldf(
"SELECT pix, year, CASE WHEN brk=0 THEN 1 ELSE 0 END AS brk1, magnitude,
CASE WHEN fire_year > 0 THEN 1 ELSE 0 END fire,
CASE WHEN harv_year > 0  THEN 1 ELSE 0 END harv,
CASE WHEN insc_year >  0 THEN 1 ELSE 0 END insc,
for_age, for_type, for_pro, elev, map
FROM dfTest"
)
dim(dfTest)
